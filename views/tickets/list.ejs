<div class="ticket-page-header mb-3">
  <div class="d-flex justify-content-between align-items-start flex-wrap gap-2">
    <div>
      <h1 class="h4 mb-1">Meine Support-Tickets</h1>
      <p class="text-muted small mb-0">
        Erstelle neue Tickets und verfolge den Status deiner offenen und abgeschlossenen Anfragen.
      </p>
    </div>
    <a href="/tickets/new" class="btn btn-primary d-flex align-items-center gap-1">
      <i class="bi bi-plus-lg"></i>
      <span>Neues Ticket</span>
    </a>
  </div>

  <div class="row g-2 mt-3 ticket-stats-row">
    <div class="col-12 col-md-4">
      <div class="ticket-stat-card">
        <div class="ticket-stat-label">Aktive Tickets</div>
        <div class="ticket-stat-value"><%= activeTickets ? activeTickets.length : 0 %></div>
      </div>
    </div>
    <div class="col-12 col-md-4">
      <div class="ticket-stat-card ticket-stat-card-warn">
        <div class="ticket-stat-label">Offen / in Bearbeitung</div>
        <div class="ticket-stat-value"><%= activeTickets ? activeTickets.length : 0 %></div>
      </div>
    </div>
    <div class="col-12 col-md-4">
      <div class="ticket-stat-card ticket-stat-card-muted">
        <div class="ticket-stat-label">Vergangene Tickets</div>
        <div class="ticket-stat-value"><%= closedTickets ? closedTickets.length : 0 %></div>
      </div>
    </div>
  </div>
</div>

<% const hasActive = activeTickets && activeTickets.length > 0; %>
<% const hasClosed = closedTickets && closedTickets.length > 0; %>

<% if (!hasActive && !hasClosed) { %>
  <div class="ticket-empty-state">
    <h2 class="h5 mb-2">Noch keine Tickets</h2>
    <p class="text-muted small mb-3">
      Wenn du ein Problem oder eine Frage hast, kannst du jederzeit ein neues Ticket erstellen.
    </p>
    <a href="/tickets/new" class="btn btn-primary">
      Ticket erstellen
    </a>
  </div>
<% } %>

<% if (hasActive) { %>
  <div class="d-flex justify-content-between align-items-center mt-4 mb-2">
    <h2 class="h6 text-muted text-uppercase mb-0">Aktive Tickets</h2>
  </div>
  <div class="row g-3">
    <% activeTickets.forEach(t => { %>
      <div class="col-12 col-md-6 col-lg-4">
        <div class="card h-100 shadow-sm border-0 ticket-card">
          <div class="card-body d-flex flex-column">
            <div class="d-flex justify-content-between align-items-start mb-2">
              <h3 class="h6 mb-0">
                <a href="/tickets/<%= t._id %>" class="text-decoration-none ticket-title-link">
                  <%= t.title %>
                </a>
              </h3>
              <span>
                <% if (t.status === 'open') { %>
                  <span class="badge rounded-pill bg-status-open">Neu</span>
                <% } else if (t.status === 'in_progress') { %>
                  <span class="badge rounded-pill bg-status-progress">In Bearbeitung</span>
                <% } else { %>
                  <span class="badge rounded-pill bg-secondary"><%= t.status %></span>
                <% } %>
              </span>
            </div>

            <% if (t.category) { %>
              <div class="small text-muted mb-2">
                <i class="bi bi-folder2-open me-1"></i>
                <span>Kategorie:</span>
                <span class="fw-semibold"><%= t.category %></span>
              </div>
            <% } %>

            <div class="mt-auto d-flex justify-content-between align-items-center small text-muted">
              <span>Erstellt am <%= new Date(t.created_at).toLocaleString('de-DE') %></span>
              <a href="/tickets/<%= t._id %>" class="btn btn-sm btn-outline-primary">
                Ã–ffnen
              </a>
            </div>
          </div>
        </div>
      </div>
    <% }) %>
  </div>
<% } %>

<% if (hasClosed) { %>
  <div class="d-flex justify-content-between align-items-center mt-4 mb-2">
    <h2 class="h6 text-muted text-uppercase mb-0">Vergangene Tickets</h2>
  </div>
  <div class="row g-3">
    <% closedTickets.forEach(t => { %>
      <div class="col-12 col-md-6 col-lg-4">
        <div class="card h-100 border-0 ticket-card ticket-card-closed">
          <div class="card-body d-flex flex-column">
            <div class="d-flex justify-content-between align-items-start mb-2">
              <h3 class="h6 mb-0">
                <a href="/tickets/<%= t._id %>" class="text-decoration-none text-muted ticket-title-link">
                  <%= t.title %>
                </a>
              </h3>
              <span class="badge rounded-pill bg-status-closed">Geschlossen</span>
            </div>

            <% if (t.category) { %>
              <div class="small text-muted mb-2">
                <i class="bi bi-folder2-open me-1"></i>
                <%= t.category %>
              </div>
            <% } %>

            <div class="mt-auto d-flex justify-content-between align-items-center small text-muted">
              <span>Erstellt am <%= new Date(t.created_at).toLocaleString('de-DE') %></span>
              <span>abgeschlossen</span>
            </div>
          </div>
        </div>
      </div>
    <% }) %>
  </div>
<% } %>
