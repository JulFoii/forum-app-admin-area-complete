(function(){
  function createBackdrop(){
    const bd=document.createElement('div');
    bd.className='modal-backdrop fade show';
    bd.style.position='fixed';
    bd.style.top='0';
    bd.style.left='0';
    bd.style.width='100vw';
    bd.style.height='100vh';
    bd.style.backgroundColor='rgba(0,0,0,.5)';
    bd.style.zIndex='1040';
    return bd;
  }
  class Modal{
    constructor(el,opts){
      this.el=el;
      this.opts=opts||{};
      this._backdropEl=null;
    }
    show(){
      if(!this.el)return;
      if(!this._backdropEl){this._backdropEl=createBackdrop();}
      document.body.appendChild(this._backdropEl);
      document.body.classList.add('modal-open');
      document.body.style.overflow='hidden';
      this.el.style.display='block';
      this.el.style.position='fixed';
      this.el.style.zIndex='1050';
      this.el.style.left='0';
      this.el.style.top='0';
      this.el.style.width='100%';
      this.el.style.height='100%';
      this.el.style.overflowY='auto';
      this.el.setAttribute('aria-modal','true');
      this.el.removeAttribute('aria-hidden');
      this.el.classList.add('show');
    }
    hide(){
      if(!this.el)return;
      this.el.classList.remove('show');
      this.el.setAttribute('aria-hidden','true');
      this.el.style.display='none';
      if(this._backdropEl&&this._backdropEl.parentNode){
        this._backdropEl.parentNode.removeChild(this._backdropEl);
      }
      this._backdropEl=null;
      document.body.classList.remove('modal-open');
      document.body.style.overflow='';
    }
  }
  Modal.getInstance=function(el){return el.__modalInstance||null;};
  Modal.getOrCreateInstance=function(el,opts){
    if(el.__modalInstance)return el.__modalInstance;
    el.__modalInstance=new Modal(el,opts);
    return el.__modalInstance;
  };
  document.addEventListener('click',function(e){
    const btn=e.target.closest('[data-bs-toggle="modal"]');
    if(!btn)return;
    const targetSel=btn.getAttribute('data-bs-target');
    if(!targetSel)return;
    const modalEl=document.querySelector(targetSel);
    if(!modalEl)return;
    e.preventDefault();
    const inst=Modal.getOrCreateInstance(modalEl,{backdrop:'static'});
    inst.show();
  });
  document.addEventListener('click',function(e){
    const dis=e.target.closest('[data-bs-dismiss="modal"]');
    if(!dis)return;
    const modalEl=dis.closest('.modal');
    if(!modalEl)return;
    e.preventDefault();
    const inst=Modal.getOrCreateInstance(modalEl);
    inst.hide();
  });
  window.bootstrap={Modal};
})();
